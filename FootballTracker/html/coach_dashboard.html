{%load static%}
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/coach_dashboard.css' %}">
    <script src="{% static 'js/coach_dashboard.js' %}" defer></script>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="profile-info">
                <a href="{% url 'profile_edit' %}" class="profile-link">
                    <img src="{% static 'images/profile_icon.png' %}" alt="Profile">
                    <span>{{ request.user.username }}</span>
                </a>
            </div>
            <nav class="header-nav">
                <a href="{% url 'messages' user_id=request.user.id %}">Üzenetek</a>
            </nav>
        </div>
    </header>

    <main>
        <div class="dashboard-container">
            <!-- Left Side: Filters -->
            <div class="filters">
                <h3>Szűrők</h3>
                <form method="GET" action="{% url 'coach_dashboard' %}">
                    <label for="user_type">Felhasználó típusa:</label>
                    <select name="user_type" id="user_type">
                        <option value="">--Válassz--</option>
                        <option value="player" {% if request.GET.user_type == 'player' %}selected{% endif %}>Játékos</option>
                        <option value="coach" {% if request.GET.user_type == 'coach' %}selected{% endif %}>Edző</option>
                        <option value="manager" {% if request.GET.user_type == 'manager' %}selected{% endif %}>Menedzser</option>
                    </select>

                    <!-- Player-specific filters -->
                    {% if request.GET.user_type == 'player' %}
                    <label for="min_height">Min. Magasság:</label>
                    <input type="number" name="min_height" id="min_height" value="{{ request.GET.min_height }}">

                    <label for="max_height">Max. Magasság:</label>
                    <input type="number" name="max_height" id="max_height" value="{{ request.GET.max_height }}">

                    <label for="min_birth_date">Születési idő (min):</label>
                    <input type="date" name="min_birth_date" id="min_birth_date" value="{{ request.GET.min_birth_date }}">

                    <label for="max_birth_date">Születési idő (max):</label>
                    <input type="date" name="max_birth_date" id="max_birth_date" value="{{ request.GET.max_birth_date }}">

                    <label for="position">Poszt:</label>
                    <select name="position" id="position">
                        <option value="">--Válassz--</option>
                        <option value="GK" {% if request.GET.position == 'GK' %}selected{% endif %}>Kapus</option>
                        <option value="RB" {% if request.GET.position == 'RB' %}selected{% endif %}>Jobbhátvéd</option>
                        <option value="CB" {% if request.GET.position == 'CB' %}selected{% endif %}>Középhátvéd</option>
                        <option value="LB" {% if request.GET.position == 'LB' %}selected{% endif %}>Balhátvéd</option>
                        <option value="CDM" {% if request.GET.position == 'CDM' %}selected{% endif %}>Védekező középpályás</option>
                        <option value="CM" {% if request.GET.position == 'CM' %}selected{% endif %}>Középpályás</option>
                        <option value="CAM" {% if request.GET.position == 'CAM' %}selected{% endif %}>Támadó középpályás</option>
                        <option value="RW" {% if request.GET.position == 'RW' %}selected{% endif %}>Jobbszélső</option>
                        <option value="LW" {% if request.GET.position == 'LW' %}selected{% endif %}>Balszélső</option>
                        <option value="ST" {% if request.GET.position == 'ST' %}selected{% endif %}>Csatár</option>
                        <option value="CF" {% if request.GET.position == 'CF' %}selected{% endif %}>Középcsatár</option>
                    </select>

                    <label for="looking_for_team">Keres csapatot:</label>
                    <input type="checkbox" name="looking_for_team" id="looking_for_team" value="True" {% if request.GET.looking_for_team %}checked{% endif %}>

                    {% endif %}
                    
                    <button type="submit">Szűrés</button>
                </form>
            </div>

            <!-- Center: Users or Posts -->
            <div class="posts">
                {% if request.GET.user_type == 'player' %}
                <h3>Játékosok</h3>
                <ul>
                    {% for player in players %}
                    <li>{{ player.user_profile.user.username }} - {{ player.position }} - {{ player.height }} cm</li>
                    {% empty %}
                    <li>Nincsenek játékosok a megadott szűrőkkel.</li>
                    {% endfor %}
                </ul>
                {% elif request.GET.user_type == 'coach' %}
                <h3>Edzők</h3>
                <ul>
                    {% for coach in coaches %}
                    <li>{{ coach.user.first_name }} {{ coach.user.last_name }} - {{ coach.team }}</li>
                    {% empty %}
                    <li>Nincsenek edzők a megadott szűrőkkel.</li>
                    {% endfor %}
                </ul>
                {% elif request.GET.user_type == 'manager' %}
                <h3>Menedzserek</h3>
                <ul>
                    {% for manager in managers %}
                    <li>{{ manager.user.username }} - {{ manager.company }}</li>
                    {% empty %}
                    <li>Nincsenek menedzserek a megadott szűrőkkel.</li>
                    {% endfor %}
                </ul>
                {% else %}
                <h3>Posztok</h3>
                {% for post in posts %}
                <div class="post">
                    <p>{{ post.content }}</p>
                    <form method="POST" action="{% url 'add_comment' %}">
                        {% csrf_token %}
                        <input type="hidden" name="post_id" value="{{ post.id }}">
                        {{ comment_form.as_p }}
                        <button type="submit">Komment</button>
                    </form>
                </div>
                {% empty %}
                <p>Nincsenek posztok.</p>
                {% endfor %}
                {% endif %}
            </div>

            <!-- Right Side: Messages -->
            <div class="messages">
                <h3>Üzenetek</h3>
                <ul>
                    {% for message in request.user.messages.all %}
                    <li>{{ message.sender }}: {{ message.content }}</li>
                    {% empty %}
                    <li>Nincsenek üzenetek.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </main>
</body>
</html>
